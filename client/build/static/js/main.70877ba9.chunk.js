(this["webpackJsonpsocket-io-client"]=this["webpackJsonpsocket-io-client"]||[]).push([[0],{127:function(e,t){},130:function(e,t,n){},132:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(24),i=n.n(o),u=n(18),s=n(9),c=n(20),l=n(66),p=(n(81),n(11)),d=n(12),m=n(14),h=n(13),f=n(3),v=n(67),g=n.n(v).a.create({headers:{post:{"Access-Control-Allow-Origin":"*"}},baseURL:"/"}),b=function(e){return function(t){g.get("/useroffline/"+e.userId).then((function(n){t(function(e){return{type:"REMOVE_USER",id:e}}(e.userId))})).catch((function(e){return console.log(e)}))}},E=function(e){return{type:"NEW_MSG",data:e}},_=function(e,t,n,r){return localStorage.setItem("token",e),localStorage.setItem("user",JSON.stringify(t)),localStorage.setItem("exp",n),function(a){a(function(e,t,n){return{type:"SET_USER",token:e,user:t,exp:n}}(e,t,n)),r.on("new_msg",(function(e){a(E(e))})),r.on("emitOn",(function(e){return a(function(e){return function(t){g.get("/user/"+e.userId).then((function(e){t({type:"ADD_USER",user:e.data})})).catch((function(e){return console.log(e)}))}}(e))})),r.on("emitOff",(function(e){return a(b(e))}))}},O=function(e){return function(t){g.get("/users",{headers:{Authorization:"Bearer "+e}}).then((function(e){t({type:"STORE_USERS",data:e.data})})).catch((function(e){return console.log(e)}))}},S=function(){return localStorage.removeItem("token"),localStorage.removeItem("user"),localStorage.removeItem("exp"),{type:"LOGOUT_USER"}},j=n(68),k=n.n(j),y=(n(130),n(69)),U=n.n(y),C=n(38),I=n.n(C),N=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e,t,n,r=this,o=null;this.props.user&&(o=a.a.createElement("div",{className:I.a.Nav},(null===(e=this.props.recipient)||void 0===e?void 0:e[0])?a.a.createElement("p",{onClick:this.props.onUnsetRecipient},"back"):null,a.a.createElement("p",null,null===(t=this.props.recipient)||void 0===t||null===(n=t[1])||void 0===n?void 0:n.name),a.a.createElement("p",{onClick:function(){var e;return r.props.onLogoutUser(null===(e=r.props.user)||void 0===e?void 0:e._id)}},"Logga ut")));return a.a.createElement("div",{className:I.a.Header},a.a.createElement("img",{src:U.a,alt:"graphic pattern"}),o)}}]),n}(r.Component),A=Object(s.b)((function(e){return{user:e.user,recipient:e.recipient}}),(function(e){return{onUnsetRecipient:function(){return e({type:"UNSET_RECIPIENT"})},onLogoutUser:function(t){return e(S())}}}))(N),L=n(26),R=n(1),w=n(15),T=n.n(w),x=function(e){var t=null,n=[T.a.InputElement],r=[T.a.Label];switch(e.invalid&&e.shouldValidate&&e.touched&&(n.push(T.a.Invalid),r.push(T.a.LabelInvalid)),e.elementType){case"input":t=a.a.createElement("input",Object.assign({className:n.join(" ")},e.elementConfig,{value:e.value,onChange:e.changed}));break;case"textarea":t=a.a.createElement("textarea",Object.assign({className:n.join(" ")},e.elementConfig,{value:e.value,onChange:e.changed}));break;case"select":t=a.a.createElement("select",{className:n.join(" "),value:e.value,onChange:e.changed},e.elementConfig.options.map((function(e){return a.a.createElement("option",{key:e.value,value:e.value},e.displayValue)})));break;default:t=a.a.createElement("input",Object.assign({className:T.a.InputElement},e.elementConfig,{value:e.value}))}return a.a.createElement("div",{className:T.a.Input},a.a.createElement("label",{className:r.join(" ")},e.elementConfig.placeholder),t)},F={email:{elementType:"input",elementConfig:{type:"email",placeholder:"Your Email"},value:"",validation:{required:!0},valid:!1,touched:!1},password:{elementType:"input",elementConfig:{type:"password",placeholder:"password",autoComplete:"current password"},value:"",validation:{required:!0},valid:!1,touched:!1}},M=n(27),H=n.n(M),G=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={authForm:F,formError:null,isLogin:!0},e.inputChangedHandler=function(t,n){var r=Object(R.a)(Object(R.a)({},e.state.authForm),{},Object(L.a)({},n,Object(R.a)(Object(R.a)({},e.state.authForm[n]),{},{value:t.target.value,valid:e.checkValidity(t.target.value,e.state.authForm[n].validation),touched:!0})));e.setState({authForm:r})},e.submitHandler=function(t){t.preventDefault();var n={email:e.state.authForm.email.value,password:e.state.authForm.password.value};e.state.isLogin?g.post("/login",n).then((function(t){e.props.onAuthenticated(t.data.token,t.data.user,t.data.exp,e.props.socket),g.get("/useronline/"+t.data.user._id,{headers:{Authorization:"Bearer "+t.data.token}}).then((function(e){console.log("resp",e.data)})).catch((function(e){return console.log(e)})),e.props.onGetUsers(t.data.token)})).catch((function(t){console.dir("error",t),e.setState({formError:t.response.data})})):(n.name=e.state.authForm.name.value,g.post("/register",n).then((function(t){e.setState({isLogin:!0})})).catch((function(t){console.dir(t),e.setState({formError:t.response.data})})))},e.switchFormHandler=function(){e.setState((function(t){var n={};return t.isLogin?n=Object(R.a)({name:{elementType:"input",elementConfig:{type:"name",placeholder:"Your Name"},value:"",validation:{required:!0},valid:!1,touched:!1}},e.state.authForm):delete(n=Object(R.a)({},e.state.authForm)).name,{isLogin:!t.isLogin,authForm:n}}))},e}return Object(d.a)(n,[{key:"checkValidity",value:function(e,t){var n=!0;return t.required&&(n=""!==e.trim()&&n),t.minLength&&(n=e.length>=t.minLength&&n),n}},{key:"render",value:function(){var e=this,t=[];for(var n in this.state.authForm)t.push({id:n,config:this.state.authForm[n]});var r=t.map((function(t){return a.a.createElement(x,{key:t.id,elementType:t.config.elementType,elementConfig:t.config.elementConfig,value:t.config.value,invalid:!t.config.valid,shouldValidate:t.config.validation,touched:t.config.touched,changed:function(n){return e.inputChangedHandler(n,t.id)}})})),o=null;this.props.isAuthenticated&&(o=a.a.createElement(f.a,{to:"/"}));var i=null;return this.state.formError&&(i=a.a.createElement("p",null,this.state.formError)),a.a.createElement("div",{className:H.a.Auth},o,a.a.createElement("div",{className:H.a.FormArea},i,a.a.createElement("form",{onSubmit:this.submitHandler},this.props.isAuthenticated?null:r,a.a.createElement("button",{className:H.a.Submit,type:"submit"},this.state.isLogin?"Login":"Signup")),a.a.createElement("p",{onClick:this.switchFormHandler,style:{fontSize:"12px"}},this.state.isLogin?"Switch to sign up":"Switch to login")))}}]),n}(r.Component),q=Object(s.b)((function(e){return{isAuthenticated:null!==e.token,socket:e.socket}}),(function(e){return{onAuthenticated:function(t,n,r,a){return e(_(t,n,r,a))},onGetUsers:function(t){return e(O(t))}}}))(G),D=n(41),V=n.n(D),W=function(e){console.log("chatString",e);var t=V.a[e.stringStyle];return a.a.createElement("div",{className:t+" "+V.a.String},a.a.createElement("p",null,e.children))},P=n(70),B=n.n(P),K=a.a.forwardRef((function(e,t){return a.a.createElement("div",{className:B.a.Submit},a.a.createElement("input",{ref:t,type:"text",value:e.val,onChange:e.change}),a.a.createElement("button",{onClick:e.send},"send msg"))})),z=n(21),J=n.n(z),Y=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).state={currentMsg:{}},e.scrollToPosition=function(){var t;e._chatWindow&&(e._chatWindow.scrollTop=null===(t=e._chatWindow)||void 0===t?void 0:t.scrollHeight)},e.startChatHandler=function(t,n,r){e._input.focus();var a=Object(R.a)({},e.state.currentMsg);a[r]="",e.setState({currentMsg:a}),e.props.socket.emit("chat",{msg:t,user:n,recipient:r}),e.props.onNewMsg({msg:t,user:n,recipient:r})},e.currentMsgHandler=function(t,n){var r=Object(R.a)({},e.state.currentMsg);r[n]=t.target.value,e.setState({currentMsg:r})},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){this.scrollToPosition()}},{key:"componentDidUpdate",value:function(e){e.messages!==this.props.messages&&this.scrollToPosition()}},{key:"render",value:function(){var e,t,n,r=this,o=null;this.props.isAuthenticated||(o=a.a.createElement(f.a,{to:"/auth"}));var i=null===(e=this.props.messages)||void 0===e?void 0:e[null===(t=this.props.recipient)||void 0===t?void 0:t[0]];i&&(i=i.sort((function(e,t){return e.timestamp-t.timestamp})).map((function(e){var t,n=null;return n=e.user===(null===(t=r.props.user)||void 0===t?void 0:t._id)?"Right":"Left",a.a.createElement(W,{key:e.id,stringStyle:n},e.msg)})));var u,s,c,l,p=null;(null===(n=this.props.recipient)||void 0===n?void 0:n[0])&&(p=a.a.createElement("div",null,i,a.a.createElement("div",null),a.a.createElement(K,{send:function(){var e,t,n;return r.startChatHandler(null===(e=r.state.currentMsg)||void 0===e?void 0:e[null===(t=r.props.recipient)||void 0===t?void 0:t[0]],r.props.user._id,null===(n=r.props.recipient)||void 0===n?void 0:n[0])},val:(null===(u=this.state.currentMsg)||void 0===u?void 0:u[null===(s=this.props.recipient)||void 0===s?void 0:s[0]])?null===(c=this.state.currentMsg)||void 0===c?void 0:c[null===(l=this.props.recipient)||void 0===l?void 0:l[0]]:"",change:function(e){var t;return r.currentMsgHandler(e,null===(t=r.props.recipient)||void 0===t?void 0:t[0])},ref:function(e){return r._input=e}})));var d=a.a.createElement("li",null,"No users currently online...");return Object.entries(this.props.onlineUsers).length>1&&(d=Object.entries(this.props.onlineUsers).filter((function(e){var t;return e[0]!==(null===(t=r.props.user)||void 0===t?void 0:t._id)})).map((function(e){var t,n=null;return e[0]===(null===(t=r.props.recipient)||void 0===t?void 0:t[0])&&(n={fontWeight:"bold"}),a.a.createElement("li",{key:e[0],style:n,onClick:function(){return r.props.onSetRecipient(e,r.props.socket)}},e[1].name,e[1].unread?a.a.createElement("span",{className:J.a.Unread},e[1].unread):null)}))),a.a.createElement("div",{className:J.a.Chat},o,this.props.recipient?a.a.createElement("div",{className:J.a.Main,ref:function(e){return r._chatWindow=e}},p):a.a.createElement("div",{className:J.a.UserList},a.a.createElement("ul",null,d)))}}]),n}(r.Component),Q=Object(s.b)((function(e){return{isAuthenticated:null!==e.token,token:e.token,socket:e.socket,user:e.user,onlineUsers:e.onlineUsers,recipient:e.recipient,messages:e.messages}}),(function(e){return{onLogoutUser:function(t){return e(S())},onGetUsers:function(t){return e(O(t))},onSetRecipient:function(t,n){return e(function(e,t){return{type:"SET_RECIPIENT",recipient:e}}(t))},onNewMsg:function(t){return e(E(t))}}}))(Y),Z=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(p.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).logoutRequest=function(t,n){t&&n&&e.props.onRemoveUser(t,n)},e}return Object(d.a)(n,[{key:"UNSAFE_componentWillMount",value:function(){var e=this,t=k()("/");this.props.onSetSocket(t);var n=localStorage.getItem("token");if(n){var r=localStorage.getItem("exp");if(r>(new Date).getTime()/1e3){var a=JSON.parse(localStorage.getItem("user"));this.props.onAuthenticated(n,a,r,t),g.get("/useronline/"+a._id,{headers:{Authorization:"Bearer "+n}}).then((function(e){console.log(e.data)})).catch((function(e){return console.log(e)})),this.props.onGetUsers(n)}}window.addEventListener("beforeunload",(function(){var t;return e.logoutRequest(null===(t=e.props.user)||void 0===t?void 0:t._id,e.props.token)}))}},{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(A,null),a.a.createElement(f.d,null,a.a.createElement(f.b,{path:"/auth",component:q}),a.a.createElement(f.b,{path:"/",component:Q}),a.a.createElement(f.a,{to:"/"})))}}]),n}(r.Component),X=Object(f.g)(Object(s.b)((function(e){return{isAuthenticated:null!==e.token,user:e.user,token:e.token}}),(function(e){return{onRemoveUser:function(t,n){return e(b({userId:t}))},onSetSocket:function(t){return e(function(e){return{type:"SET_SOCKET",socket:e}}(t))},onAuthenticated:function(t,n,r,a){return e(_(t,n,r,a))},onGetUsers:function(t){return e(O(t))}}}))(Z)),$=n(71),ee=n(134),te={token:null,user:null,recipient:null,socket:null,onlineUsers:{},messages:{}},ne=function(e,t){return e.socket.emit("join",{name:t.user.name,id:t.user._id}),Object(R.a)(Object(R.a)({},e),{},{token:t.token,user:t.user})},re=function(e,t){var n=Object(R.a)(Object(R.a)({},e.onlineUsers),t.user);return Object(R.a)(Object(R.a)({},e),{},{onlineUsers:n})},ae=function(e,t){var n=Object(R.a)({},e.onlineUsers);return delete n[t.id],Object(R.a)(Object(R.a)({},e),{},{onlineUsers:n})},oe=function(e,t){var n=t.data,r=n.msg,a=n.user,o=n.recipient,i=e.user._id,u={timestamp:Date.now(),user:a,msg:r,id:Object(ee.a)()},s=Object(R.a)({},e.messages),c=Object(R.a)({},e.onlineUsers),l=null;if(i===a)l=o;else{var p;if(l=a,a!==(null===(p=e.recipient)||void 0===p?void 0:p[0])){var d=Object(R.a)({},e.onlineUsers[a]);d.unread?d.unread++:d.unread=1,c[a]=d}console.log("[user]",c)}return e.messages[l]?s[l]=[].concat(Object($.a)(e.messages[l]),[u]):s[l]=[u],Object(R.a)(Object(R.a)({},e),{},{messages:s,onlineUsers:c})},ie=function(e,t){return e.socket.emit("leaveChat",e.user._id),Object(R.a)(Object(R.a)({},e),{},{token:null,user:null,recipient:null})},ue=function(e,t){return Object(R.a)(Object(R.a)({},e),{},{onlineUsers:t.data})},se=function(e,t){return Object(R.a)(Object(R.a)({},e),{},{recipient:null})},ce=function(e,t){var n=Object(R.a)({},e.onlineUsers),r=Object(R.a)({},e.onlineUsers[t.recipient[0]]);return r.unread=!1,n[t.recipient[0]]=r,console.log(r),Object(R.a)(Object(R.a)({},e),{},{recipient:t.recipient,onlineUsers:n})},le=function(e,t){return Object(R.a)(Object(R.a)({},e),{},{socket:t.socket})},pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:te,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"STORE_USERS":return ue(e,t);case"SET_USER":return ne(e,t);case"ADD_USER":return re(e,t);case"REMOVE_USER":return ae(e,t);case"NEW_MSG":return oe(e,t);case"LOGOUT_USER":return ie(e);case"SET_RECIPIENT":return ce(e,t);case"UNSET_RECIPIENT":return se(e);case"SET_SOCKET":return le(e,t);default:return e}},de=null,me=Object(c.c)(pe,de(Object(c.a)(l.a))),he=a.a.createElement(s.a,{store:me},a.a.createElement(u.a,null,a.a.createElement(X,null)));i.a.render(he,document.getElementById("root"))},15:function(e,t,n){e.exports={Input:"Input_Input__3r5Ke",Label:"Input_Label__1qyHr",LabelInvalid:"Input_LabelInvalid__3d-81",InputElement:"Input_InputElement__2m88K",Invalid:"Input_Invalid__16Mis"}},21:function(e,t,n){e.exports={Chat:"Chat_Chat__lgG6O",UserList:"Chat_UserList__3Cv8B",Main:"Chat_Main__xq6Ur"}},27:function(e,t,n){e.exports={Auth:"Auth_Auth__1Zul_",FormArea:"Auth_FormArea__3l6F0",Submit:"Auth_Submit__38lFt"}},38:function(e,t,n){e.exports={Header:"Header_Header__1xrSh",Nav:"Header_Nav__3L4rV"}},41:function(e,t,n){e.exports={String:"ChatString_String__2TK7_",Left:"ChatString_Left__xAFyy",Right:"ChatString_Right__7Vx9q"}},69:function(e,t,n){e.exports=n.p+"static/media/header.0c3efb58.svg"},70:function(e,t,n){e.exports={Submit:"chatSubmit_Submit__Qxdef"}},72:function(e,t,n){e.exports=n(132)},81:function(e,t,n){}},[[72,1,2]]]);
//# sourceMappingURL=main.70877ba9.chunk.js.map